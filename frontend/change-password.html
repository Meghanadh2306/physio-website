<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Change Password</title>

<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --primary:#0f766e;
  --secondary:#14b8a6;
  --card:#ffffff;
  --text:#1f2937;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:"Segoe UI",Arial;
  background:
    linear-gradient(rgba(230,242,241,.92),rgba(230,242,241,.92)),
    url("https://images.unsplash.com/photo-1586773860418-d37222d8fce3");
  background-size:cover;
}

.card{
  max-width:380px;
  width:92%;
  background:var(--card);
  padding:32px;
  border-radius:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
}

.logo{
  text-align:center;
  margin-bottom:20px;
}
.logo img{
  max-width:260px;
  display:block;
  margin:0 auto;
}
.logo h2{
  margin:12px 0 0;
  color:var(--primary);
}
.logo p{
  margin:4px 0 0;
  font-size:13px;
  color:#555;
}

.pass-wrap{
  position:relative;
  margin-top:14px;
}
input{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}
.eye{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  color:#555;
}

button{
  width:100%;
  padding:12px;
  margin-top:18px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:white;
  border:none;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}

.error{
  color:#dc2626;
  text-align:center;
  margin-top:10px;
  font-size:14px;
}

.link{
  text-align:center;
  margin-top:14px;
  font-size:13px;
  color:var(--primary);
  cursor:pointer;
}
.link:hover{text-decoration:underline}

.footer{
  text-align:center;
  margin-top:18px;
  font-size:12px;
  color:#666;
}
</style>
</head>

<body>

<div class="card">

  <div class="logo">
    <img src="https://physio-website-nih7.onrender.com/assets/logo.jpg">
    <h2>Sri Physiotherapy Clinic</h2>
    <p>Change Password</p>
  </div>

  <div class="pass-wrap">
    <input id="oldPass" type="password" placeholder="Old Password">
    <span class="eye" onclick="togglePass('oldPass',this)">
      <i class="fa-solid fa-eye"></i>
    </span>
  </div>

  <div class="pass-wrap">
    <input id="newPass" type="password" placeholder="New Password">
    <span class="eye" onclick="togglePass('newPass',this)">
      <i class="fa-solid fa-eye"></i>
    </span>
  </div>

  <div class="pass-wrap">
    <input id="confirmPass" type="password" placeholder="Confirm New Password">
    <span class="eye" onclick="togglePass('confirmPass',this)">
      <i class="fa-solid fa-eye"></i>
    </span>
  </div>

  <button onclick="changePassword()">Change Password</button>

  <div id="error" class="error"></div>

  <div class="link" onclick="goBack()">‚Üê Back to Dashboard</div>

  <div class="footer">
    ¬© 2026 Sri Physiotherapy Center
  </div>

</div>

<script>
const API = "https://physio-website-nih7.onrender.com";
const token = localStorage.getItem("token");

// üîê Protect page
if(!token){
  location.href = "index.html";
}

function togglePass(id, el){
  const input = document.getElementById(id);
  const icon = el.querySelector("i");

  if(input.type === "password"){
    input.type = "text";
    icon.className = "fa-solid fa-eye-slash";
  }else{
    input.type = "password";
    icon.className = "fa-solid fa-eye";
  }
}

async function changePassword(){
  error.innerText = "";

  const oldPassword = oldPass.value.trim();
  const newPassword = newPass.value.trim();
  const confirm = confirmPass.value.trim();

  if(!oldPassword || !newPassword || !confirm){
    error.innerText = "All fields are required";
    return;
  }

  if(newPassword !== confirm){
    error.innerText = "Passwords do not match";
    return;
  }

  try{
    const res = await fetch(`${API}/admin/change-password`,{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer " + token
      },
      body:JSON.stringify({ oldPassword, newPassword })
    });

    const data = await res.json();

    if(!res.ok){
      error.innerText = data.message || "Password change failed";
      return;
    }

    alert("Password changed successfully. Please login again.");
    localStorage.removeItem("token");
    location.href = "index.html";

  }catch{
    error.innerText = "Server not reachable";
  }
}

function goBack(){
  location.href = "dashboard.html";
}
</script>

</body>
</html>
